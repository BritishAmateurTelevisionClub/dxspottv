<html>
<body>
</body>
<script src="/lib/jquery-3.2.1.min.js"></script>
<script>
var key = getQueryVariable('key');
if(!key)
{
    $("body").append($("<h2></h2>").text("Key not found."));
}
else
{
    var newDiv = $("<div></div>");
    newDiv.append($("<h2></h2>").text("Reset Password."));
    newDiv.append($("<b></b>").text('New Password: '));
    newDiv.append($("<input></input").attr('type','password').attr('id','input-password1'));
    newDiv.append($("<b></b>").text('Repeat Password: '));
    newDiv.append($("<input></input").attr('type','password').attr('id','input-password2'));
    newDiv.append($("</br>"));
    newDiv.append($("<button></button>").attr('id','input-button').text("Submit"));
    newDiv.append($("</br>"));
    newDiv.append($("<span></span>").attr('id','input-status'));
    $("body").append(newDiv);
    $("#input-button").click(submitForm);
}
function submitForm()
{
    $("#input-status").text("");
    if($("#input-password1").val()=="")
    {
        $("#input-status").text("Error: Enter a new password");
        return false;
    }
    if($("#input-password1").val()!=$("#input-password2").val())
    {
        $("#input-status").text("Error: Passwords do not match");
        return false;
    }
    $.post("/ajax/changePassword.php", { key: key, passwd: $("#input-password1").val() }) 
    .done(function(data)
    {
        if(data=="Reset key and/or password not provided")
        {
            $("#input-status").text("System Error: Please contact Phil.");
            return false;
        }
        if(data=="Reset key does not exist")
        {
            $("#input-status").text("Error: Reset key invalid or expired.");
            return false;
        }
        if(data=="Done.")
        {
            $("#input-status").text("Password change successful!");
            return false;
        }
    });
}
function getQueryVariable(variable)
{
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++)
    {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable)
        {
            return decodeURIComponent(pair[1]);
        }
    }
    return false;
}
</script>
</html>
